<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Chi Tiêu Sinh Viên 3.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Bảng màu */
            --primary-color: #4a90e2; 
            --primary-dark: #357abd;
            
            /* Màu trạng thái XANH LÁ (An toàn) */
            --success-color: #27ae60;
            --success-bg: #eafaf1;
            
            /* Màu trạng thái ĐỎ (Cảnh báo) */
            --alert-color: #e74c3c;
            --alert-bg: #fdedec;
            
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
            --text-light: #7f8c8d;
            --shadow: 0 4px 15px rgba(0,0,0,0.08);
            --shadow-hover: 0 8px 25px rgba(0,0,0,0.12);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            background-image: linear-gradient(135deg, #f0f2f5 0%, #dfe4ea 100%);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background: linear-gradient(to right, var(--primary-color), #6a5acd);
            color: white;
            padding: 25px 20px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        header h1 {
            margin: 0;
            font-weight: 700;
            font-size: 1.8rem;
            letter-spacing: 1px;
        }

        header i { margin-right: 10px; color: #ffd700; }

        .container {
            max-width: 1100px;
            margin: 30px auto;
            padding: 0 20px;
            flex: 1;
        }

        /* Input Section */
        .input-section {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            align-items: flex-end;
            justify-content: space-between;
            border-left: 5px solid var(--primary-color);
        }

        .form-group { flex: 1; min-width: 280px; }

        label {
            display: block; margin-bottom: 10px;
            font-weight: 600; color: var(--text-color);
        }
        label i { margin-right: 8px; color: var(--primary-color); }

        input[type="number"], select {
            width: 100%; padding: 12px 15px;
            border: 2px solid #eee; border-radius: 8px;
            font-size: 16px; font-family: 'Poppins', sans-serif;
            box-sizing: border-box; transition: border-color 0.3s;
        }
        input[type="number"]:focus, select:focus {
            outline: none; border-color: var(--primary-color);
        }

        /* Budget Grid */
        .budget-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
        }

        .budget-card {
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border-top: 4px solid #ddd; /* Màu mặc định khi chưa có tiền */
        }

        .budget-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-hover); }

        /* Thanh trang trí trên đầu thẻ */
        .budget-card::before {
            content: ''; position: absolute;
            top: 0; left: 0; right: 0; height: 4px;
            transition: background 0.3s;
        }

        /* --- TRẠNG THÁI SUCCESS (Xanh lá) --- */
        .budget-card.success {
            background-color: var(--success-bg);
            border-top-color: var(--success-color);
        }
        .budget-card.success::before { background: var(--success-color); }
        .budget-card.success .category-icon {
            color: var(--success-color);
            background: rgba(39, 174, 96, 0.15);
        }

        /* --- TRẠNG THÁI WARNING (Đỏ) --- */
        .budget-card.warning {
            background-color: var(--alert-bg);
            border-top-color: var(--alert-color);
        }
        .budget-card.warning::before { background: var(--alert-color); }
        .budget-card.warning .category-icon {
            color: var(--alert-color);
            background: rgba(231, 76, 60, 0.15);
        }

        .card-header {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 20px;
            padding-bottom: 15px; border-bottom: 2px dashed rgba(0,0,0,0.05);
        }

        .card-title-wrapper { display: flex; align-items: center; }

        .category-icon {
            display: inline-flex; align-items: center; justify-content: center;
            width: 40px; height: 40px;
            background: #eee; color: #666; /* Mặc định */
            border-radius: 50%; margin-right: 12px; font-size: 1.2rem;
            transition: all 0.3s;
        }

        .card-header h3 { margin: 0; font-size: 1.1rem; font-weight: 600; }

        .limit-info { font-size: 0.85rem; color: var(--text-light); text-align: right; }
        .limit-amount { display: block; font-weight: 700; color: var(--text-color); font-size: 1.1rem; }

        /* Expense List */
        .expense-list {
            list-style: none; padding: 0; margin: 0 0 20px 0;
            max-height: 250px; overflow-y: auto;
        }
        .expense-list::-webkit-scrollbar { width: 6px; }
        .expense-list::-webkit-scrollbar-thumb { background-color: #ccc; border-radius: 10px; }

        .expense-item {
            display: flex; gap: 10px; margin-bottom: 10px;
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .expense-item input {
            padding: 8px 12px; border: 1px solid #ddd;
            border-radius: 6px; font-size: 14px;
        }
        .expense-item input[type="text"] { flex: 2; }
        .expense-item input[type="number"] { flex: 1; }

        .btn-add {
            background: white; border: 2px dashed #bbb;
            width: 100%; padding: 10px; color: #666;
            font-weight: 600; cursor: pointer; border-radius: 8px;
            transition: all 0.3s; font-family: 'Poppins', sans-serif;
        }
        .btn-add:hover { background: rgba(0,0,0,0.02); border-color: #999; }
        
        /* Màu nút thay đổi theo trạng thái thẻ */
        .budget-card.success .btn-add { border-color: var(--success-color); color: var(--success-color); }
        .budget-card.success .btn-add:hover { background: rgba(39, 174, 96, 0.1); }
        
        .budget-card.warning .btn-add { border-color: var(--alert-color); color: var(--alert-color); }
        .budget-card.warning .btn-add:hover { background: rgba(231, 76, 60, 0.1); }

        .card-footer {
            margin-top: 20px; padding-top: 15px;
            border-top: 2px dashed rgba(0,0,0,0.05);
        }

        .total-row {
            display: flex; justify-content: space-between;
            font-weight: 600; margin-bottom: 5px; font-size: 1.05rem;
        }

        .status-msg { font-size: 0.9rem; text-align: right; min-height: 1.4em; font-weight: 500; }
        
        /* Text Status Colors */
        .success-text { color: var(--success-color); display: flex; align-items: center; justify-content: flex-end; }
        .warning-text { color: var(--alert-color); display: flex; align-items: center; justify-content: flex-end; }
        .success-text i, .warning-text i { margin-right: 5px; }

        footer {
            background: #2c3e50; color: #bdc3c7;
            text-align: center; padding: 20px;
            font-size: 0.9rem; margin-top: auto; letter-spacing: 1px;
        }
    </style>
</head>
<body>

<header>
    <h1><i class="fa-solid fa-coins"></i> QUẢN LÍ CHI TIÊU SINH VIÊN</h1>
</header>

<div class="container">
    <div class="input-section">
        <div class="form-group">
            <label for="totalIncome"><i class="fa-solid fa-money-bill-wave"></i> Tổng thu nhập tháng này (VNĐ):</label>
            <input type="number" id="totalIncome" placeholder="VD: 5000000" oninput="calculateBudget()">
        </div>
        <div class="form-group">
            <label for="methodSelect"><i class="fa-solid fa-sliders"></i> Chọn phương pháp quản lý:</label>
            <select id="methodSelect" onchange="changeMethod()">
                <option value="503020">Phương pháp 50/30/20 (Cơ bản)</option>
                <option value="6jars">Phương pháp 6 Chiếc Lọ JARS (Chi tiết)</option>
            </select>
        </div>
    </div>

    <div id="budgetContainer" class="budget-grid">
        </div>
</div>

<footer>
    ©NHÓM 5 - DCT25A
</footer>

<script>
    const methods = {
        "503020": [
            { id: "needs", name: "Nhu cầu thiết yếu (50%)", percent: 0.5, icon: "fa-solid fa-house-chimney" },
            { id: "wants", name: "Mong muốn cá nhân (30%)", percent: 0.3, icon: "fa-solid fa-cart-shopping" },
            { id: "savings", name: "Tiết kiệm / Trả nợ (20%)", percent: 0.2, icon: "fa-solid fa-piggy-bank" }
        ],
        "6jars": [
            { id: "nec", name: "Thiết yếu (NEC - 55%)", percent: 0.55, icon: "fa-solid fa-basket-shopping" },
            { id: "lts", name: "Tiết kiệm dài hạn (LTS - 10%)", percent: 0.1, icon: "fa-solid fa-vault" },
            { id: "edu", name: "Giáo dục (EDU - 10%)", percent: 0.1, icon: "fa-solid fa-graduation-cap" },
            { id: "play", name: "Hưởng thụ (PLAY - 10%)", percent: 0.1, icon: "fa-solid fa-gamepad" },
            { id: "ffa", name: "Tự do tài chính (FFA - 10%)", percent: 0.1, icon: "fa-solid fa-chart-line" },
            { id: "give", name: "Từ thiện (GIVE - 5%)", percent: 0.05, icon: "fa-solid fa-hand-holding-heart" }
        ]
    };

    let currentMethod = "503020";
    let expensesData = {};

    function init() {
        changeMethod();
    }

    function changeMethod() {
        currentMethod = document.getElementById("methodSelect").value;
        const container = document.getElementById("budgetContainer");
        container.innerHTML = "";
        expensesData = {}; 

        const categories = methods[currentMethod];
        
        categories.forEach(cat => {
            expensesData[cat.id] = [];
            
            const card = document.createElement("div");
            card.className = "budget-card";
            card.id = `card-${cat.id}`;
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="card-title-wrapper">
                        <div class="category-icon"><i class="${cat.icon}"></i></div>
                        <h3>${cat.name}</h3>
                    </div>
                    <div class="limit-info">Hạn mức:<span class="limit-amount" id="limit-${cat.id}">0</span></div>
                </div>
                <ul class="expense-list" id="list-${cat.id}"></ul>
                <button class="btn-add" onclick="addExpenseItem('${cat.id}')"><i class="fa-solid fa-plus"></i> Thêm khoản chi</button>
                <div class="card-footer">
                    <div class="total-row">
                        <span>Đã chi tiêu:</span>
                        <span id="spent-${cat.id}">0 đ</span>
                    </div>
                    <div class="status-msg" id="status-${cat.id}"></div>
                </div>
            `;
            container.appendChild(card);
        });
        
        calculateBudget();
    }

    function calculateBudget() {
        const incomeInput = document.getElementById("totalIncome").value;
        const income = parseFloat(incomeInput) || 0;
        const categories = methods[currentMethod];

        categories.forEach(cat => {
            const limit = income * cat.percent;
            document.getElementById(`limit-${cat.id}`).innerText = limit.toLocaleString('vi-VN') + ' đ';

            let totalSpent = 0;
            if (expensesData[cat.id]) {
                expensesData[cat.id].forEach(item => totalSpent += item.cost);
            }

            document.getElementById(`spent-${cat.id}`).innerText = totalSpent.toLocaleString('vi-VN') + " đ";

            const card = document.getElementById(`card-${cat.id}`);
            const statusMsg = document.getElementById(`status-${cat.id}`);

            // Logic Màu sắc: Xanh (Thừa tiền) vs Đỏ (Thiếu tiền)
            if (income > 0) {
                if (totalSpent > limit) {
                    // Vượt quá -> Đỏ
                    card.classList.add("warning");
                    card.classList.remove("success");
                    const over = totalSpent - limit;
                    statusMsg.innerHTML = `<span class="warning-text"><i class="fa-solid fa-triangle-exclamation"></i> Vượt quá: ${over.toLocaleString('vi-VN')} đ!</span>`;
                } else {
                    // Chưa vượt quá -> Xanh lá
                    card.classList.remove("warning");
                    card.classList.add("success");
                    const remain = limit - totalSpent;
                    statusMsg.innerHTML = `<span class="success-text"><i class="fa-solid fa-check-circle"></i> Còn dư: ${remain.toLocaleString('vi-VN')} đ</span>`;
                }
            } else {
                // Chưa nhập thu nhập -> Xóa các class màu
                card.classList.remove("warning");
                card.classList.remove("success");
                statusMsg.innerHTML = "";
            }
        });
    }

    function addExpenseItem(categoryId) {
        const list = document.getElementById(`list-${categoryId}`);
        const li = document.createElement("li");
        li.className = "expense-item";
        
        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.placeholder = "Tên khoản chi...";
        
        const costInput = document.createElement("input");
        costInput.type = "number";
        costInput.placeholder = "Số tiền...";
        
        const updateFunc = function() {
            updateExpensesData(categoryId, li, nameInput.value, costInput.value);
        };

        costInput.oninput = updateFunc;
        nameInput.oninput = updateFunc;
        
        setTimeout(() => nameInput.focus(), 100);

        li.appendChild(nameInput);
        li.appendChild(costInput);
        list.appendChild(li);
        list.scrollTop = list.scrollHeight;
        
        expensesData[categoryId].push({ el: li, name: "", cost: 0 });
    }

    function updateExpensesData(categoryId, element, name, cost) {
        const costValue = parseFloat(cost) || 0;
        const item = expensesData[categoryId].find(x => x.el === element);
        if (item) {
            item.name = name;
            item.cost = costValue;
        }
        calculateBudget();
    }

    window.onload = init;

</script>

</body>
</html>
